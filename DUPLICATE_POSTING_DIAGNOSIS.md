# 채팅방 중복 포스팅 문제 진단 가이드

## 🔍 문제 확인

**증상**: 한 군데만 2번 포스팅되는 것 같음

**가능한 원인:**
1. 같은 채팅방 URL이 중복 등록됨
2. 체크박스 상태가 올바르게 저장되지 않음
3. 포스팅 중 에러 발생 후 재시도
4. 설정 파일이 손상됨

---

## ✅ 테스트 결과

### 코드 검증 완료

```
✅ 체크된 채팅방만 포스팅됩니다
✅ 각 채팅방에 1번씩만 포스팅됩니다
✅ 중복 포스팅 없습니다
```

**테스트 시나리오:**
```
등록된 채팅방: 5개
- 채팅방1: ✅ 체크
- 채팅방2: ❌ 체크 해제
- 채팅방3: ✅ 체크
- 채팅방4: ❌ 체크 해제
- 채팅방5: ✅ 체크

포스팅 결과:
→ 채팅방1, 채팅방3, 채팅방5만 1번씩 포스팅
```

---

## 🔧 문제 진단 방법

### 1단계: 설정 파일 확인

**config/config.json 열기:**

```json
{
  "chat_rooms": [
    {
      "name": "채팅방1",
      "url": "https://band.us/band/96676876/chat/CtVOZO",
      "enabled": true
    },
    {
      "name": "채팅방2",
      "url": "https://band.us/band/12345678/chat/AbCdEf",
      "enabled": false
    }
  ]
}
```

**확인 사항:**
- [ ] 같은 URL이 여러 번 등록되지 않았는가?
- [ ] `"enabled": true`인 채팅방이 몇 개인가?
- [ ] URL이 정확한가?

---

### 2단계: 로그 확인

**logs/ 폴더의 최신 로그 파일 확인:**

```
logs/band_poster_20260123.log
```

**정상적인 로그 예시:**

```
[14:00:00] 📢 3개 채팅방에 포스팅 시작
[14:00:01] [1/3] [채팅방1] 채팅방 포스팅 중...
[14:00:05] ✅ 채팅방 포스팅 완료: https://band.us/.../chat/...
[14:00:05] ⏱️ 3초 대기 중...
[14:00:08] [2/3] [채팅방3] 채팅방 포스팅 중...
[14:00:12] ✅ 채팅방 포스팅 완료: https://band.us/.../chat/...
[14:00:12] ⏱️ 3초 대기 중...
[14:00:15] [3/3] [채팅방5] 채팅방 포스팅 중...
[14:00:19] ✅ 채팅방 포스팅 완료: https://band.us/.../chat/...
[14:00:19] ✅ 포스팅 완료: 3/3 성공
```

**문제가 있는 로그 예시:**

```
[14:00:00] 📢 2개 채팅방에 포스팅 시작
[14:00:01] [1/2] [채팅방1] 채팅방 포스팅 중...
[14:00:05] ✅ 채팅방 포스팅 완료: https://band.us/.../chat/ABC
[14:00:08] [2/2] [채팅방1] 채팅방 포스팅 중...  ← 같은 채팅방!
[14:00:12] ✅ 채팅방 포스팅 완료: https://band.us/.../chat/ABC
```

**확인 사항:**
- [ ] "X개 채팅방에 포스팅 시작"의 숫자가 맞는가?
- [ ] 각 채팅방 이름이 다른가?
- [ ] 같은 URL이 반복되지 않는가?

---

### 3단계: GUI에서 확인

**프로그램 실행 후:**

1. **등록된 채팅방 목록 확인**
   ```
   ✓ 등록된 채팅방 (체크하여 선택)
   ┌─────────────────────────────┐
   │ ☑ [채팅방1]                 │
   │   https://band.us/.../ABC   │
   │                             │
   │ ☐ [채팅방2]                 │
   │   https://band.us/.../DEF   │
   │                             │
   │ ☑ [채팅방3]                 │
   │   https://band.us/.../GHI   │
   └─────────────────────────────┘
   ```

2. **중복 확인**
   - 같은 이름이 여러 번 표시되는가?
   - 같은 URL이 여러 번 표시되는가?

3. **체크박스 상태 확인**
   - 체크된 채팅방이 몇 개인가?
   - 의도한 채팅방만 체크되어 있는가?

---

## 🛠️ 해결 방법

### 해결 1: 중복 채팅방 제거

**중복이 발견된 경우:**

1. GUI에서 중복된 채팅방 삭제
   - 삭제할 채팅방 선택
   - [✖ 삭제] 버튼 클릭

2. 또는 설정 파일 직접 수정
   ```json
   {
     "chat_rooms": [
       // 중복된 항목 제거
     ]
   }
   ```

3. [💾 설정 저장] 클릭

---

### 해결 2: 체크박스 상태 확인

**체크박스 확인:**

1. 원하는 채팅방만 체크
2. 나머지는 체크 해제
3. [💾 설정 저장] 클릭
4. 프로그램 재시작하여 확인

---

### 해결 3: 설정 파일 초기화

**설정 파일이 손상된 경우:**

```bash
# 1. 백업
copy config\config.json config\config.backup.json

# 2. 삭제
del config\config.json

# 3. 프로그램 재시작 (자동으로 새 설정 생성)
```

**다시 설정:**
1. 채팅방 추가
2. 포스트 추가
3. 스케줄 설정
4. [💾 설정 저장]

---

### 해결 4: 로그 레벨 변경 (디버깅)

**더 자세한 로그 보기:**

```json
{
  "settings": {
    "log_level": "DEBUG"
  }
}
```

**로그 확인:**
```
logs/band_poster_YYYYMMDD.log
```

---

## 📊 예상 포스팅 횟수 계산

### 계산 방법

```
포스팅 1회 = 활성화된 채팅방 개수 × 1번

예시:
- 등록된 채팅방: 5개
- 체크된 채팅방: 3개
- 포스팅 횟수: 3번 (각 채팅방에 1번씩)
```

### 시간별 계산

```
간격: 4분
시간: 1시간 (60분)

예상 포스팅 라운드: 60 ÷ 4 = 15회
활성화된 채팅방: 3개

총 포스팅 횟수: 15회 × 3개 = 45번
각 채팅방당: 15번
```

---

## 🔍 실시간 모니터링

### 모니터링 체크리스트

**포스팅 중 확인:**

```
✓ 로그 창에서 실시간 확인
  [1/3] [채팅방1] ← 번호와 이름 확인
  [2/3] [채팅방3] ← 다른 채팅방인지 확인
  [3/3] [채팅방5] ← 마지막 채팅방 확인

✓ Chrome 브라우저에서 확인
  - 채팅방 URL이 바뀌는가?
  - 다른 채팅방으로 이동하는가?

✓ 카운트다운 확인
  - "3/3 성공" 메시지
  - 다음 포스팅까지 대기
```

---

## 🎯 테스트 방법

### 간단한 테스트

1. **최소 설정으로 테스트**
   ```
   채팅방: 2개만 등록
   체크: 2개 모두 체크
   간격: 1분 (테스트용)
   ```

2. **수동 실행으로 테스트**
   ```
   [🚀 수동 실행] 버튼 클릭
   로그 확인
   ```

3. **로그 검증**
   ```
   "2개 채팅방에 포스팅 시작" 확인
   [1/2], [2/2] 메시지 확인
   "2/2 성공" 확인
   ```

---

## 💡 추가 팁

### 팁 1: 채팅방 별명 활용

**별명을 다르게 지정:**
```
❌ 나쁜 예:
- 채팅방
- 채팅방
- 채팅방

✅ 좋은 예:
- 동창회 채팅방
- 가족 채팅방
- 친구 채팅방
```

**장점:**
- 로그에서 구분 쉬움
- 중복 발견 쉬움
- 관리 편리함

---

### 팁 2: URL 복사 주의

**정확한 URL 복사:**
```
올바른 URL:
https://band.us/band/96676876/chat/CtVOZO

잘못된 URL:
https://band.us/band/96676876  ← /chat/xxx 없음
https://band.us/               ← 채팅방 ID 없음
```

---

### 팁 3: 주기적으로 설정 확인

**매주 확인:**
- 채팅방 목록
- 체크박스 상태
- 중복 여부

---

## 📝 요약

### 정상 동작 확인

```
✅ 테스트 통과: 코드는 정상
✅ 체크된 채팅방만 포스팅
✅ 각 채팅방에 1번씩만 포스팅
✅ 중복 없음
```

### 문제 발생 시

```
1. 설정 파일 확인 (config/config.json)
2. 로그 확인 (logs/)
3. GUI에서 중복 확인
4. 해결 방법 적용
5. 테스트
```

---

## 🔗 관련 문서

- 📚 [README.md](README.md) - 메인 가이드
- 🚀 [WEB_QUICK_START.md](WEB_QUICK_START.md) - 빠른 시작
- 🔧 [BUILD_TROUBLESHOOTING.md](BUILD_TROUBLESHOOTING.md) - 문제 해결

---

**저장소**: https://github.com/rpaakdi1-spec/naver-band-auto-poster

**테스트 스크립트**: `test_chat_rooms.py`

**버전**: v5.1.0
